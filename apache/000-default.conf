<VirtualHost *:8888>
    ServerName altaqastrategy.com
    ServerAlias www.altaqastrategy.com

    DocumentRoot /app/dist/public

    # Enable CORS headers
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization"

    <Directory /app/dist/public>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted

        # Handle SPA routing
        RewriteEngine On
        RewriteBase /
        # Don't rewrite files or directories
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        # Rewrite everything else to index.html
        RewriteRule ^(.*)$ index.html [L,QSA]
    </Directory>

    # Proxy API requests to Node.js backend
    ProxyPreserveHost On
    ProxyRequests Off

    # API Proxy configuration
    <Location /api>
        ProxyPass http://localhost:5050/api
        ProxyPassReverse http://localhost:5050/api
    </Location>

    # Proper handling of WebSocket connections if needed
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:5050/$1" [P,L]

    # Logging configuration
    ErrorLog /var/log/apache2/altaqastrategy.com-error.log
    CustomLog /var/log/apache2/altaqastrategy.com-access.log combined
    LogLevel warn
</VirtualHost>